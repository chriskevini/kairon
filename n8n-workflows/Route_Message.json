{
  "name": "Route_Message",
  "nodes": [
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -12848,
        8080
      ],
      "id": "91f732dd-8250-4342-ae01-365e0b336809",
      "name": "Receive Event"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "react",
        "guildId": {
          "__rl": true,
          "value": "={{ $json.ctx.event.guild_id }}",
          "mode": "id"
        },
        "channelId": {
          "__rl": true,
          "value": "={{ $json.ctx.event.channel_id }}",
          "mode": "id"
        },
        "messageId": "={{ $json.ctx.event.message_id }}",
        "emoji": "=ðŸ”µ"
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        -12624,
        7984
      ],
      "id": "476cc1ef-8e72-4df6-ab57-42bda8f06403",
      "name": "React with ðŸ”µ",
      "webhookId": "react-processing",
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 1000,
      "credentials": {
        "discordBotApi": {
          "id": "hvetTjtpeKFB1V0I",
          "name": "Discord Bot account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "has-tag",
              "leftValue": "={{ $json.ctx.event.tag }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -12400,
        8400
      ],
      "id": "c3c18343-a082-4961-8b41-20c2af7240dc",
      "name": "Has Tag?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "in-thread",
              "leftValue": "={{ $json.ctx.event.thread_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -12624,
        8176
      ],
      "id": "6f431c36-8c0b-4d84-9d44-a78ab41eadd1",
      "name": "In Thread?"
    },
    {
      "parameters": {
        "jsCode": "// Add projection type to ctx for Capture_Projection workflow\nconst projectionType = $json.ctx.routing.intent; // 'activity', 'note', or 'todo'\n\nreturn [{\n  json: {\n    ctx: {\n      ...$json.ctx,\n      projection: {\n        type: projectionType\n      }\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -11952,
        8080
      ],
      "id": "a1b2c3d4-prep-proj-type-node",
      "name": "Prepare Projection"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "fCzIE4pwbotbDlD6",
          "mode": "list",
          "cachedResultUrl": "/workflow/fCzIE4pwbotbDlD6",
          "cachedResultName": "Capture_Projection"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -11728,
        8080
      ],
      "id": "e5f6g7h8-capture-projection-node",
      "name": "Capture Projection"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "LNzKP4CSjrY7FW5v",
          "mode": "list",
          "cachedResultUrl": "/workflow/LNzKP4CSjrY7FW5v",
          "cachedResultName": "Start_Thread"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -11952,
        8272
      ],
      "id": "4f5dbc85-1925-42ca-9d48-7cfdb8bc862f",
      "name": "Start Thread"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "v6t7HCxr2OOXvb2z",
          "mode": "list",
          "cachedResultUrl": "/workflow/v6t7HCxr2OOXvb2z",
          "cachedResultName": "Execute_Command"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -11952,
        8464
      ],
      "id": "be0f00ad-4e2f-4338-bfef-8816cee4777f",
      "name": "Execute Command"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "CAQ4IaApsD2QpLiz",
          "mode": "list",
          "cachedResultUrl": "/workflow/CAQ4IaApsD2QpLiz",
          "cachedResultName": "Capture_Thread"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -12176,
        7840
      ],
      "id": "15a4061b-cde3-4fce-89b9-8d2864c1ad53",
      "name": "Capture Thread"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "IAjqXOmWzGUHp9Ea",
          "mode": "list",
          "cachedResultUrl": "/workflow/IAjqXOmWzGUHp9Ea",
          "cachedResultName": "Continue_Thread"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -12176,
        8032
      ],
      "id": "c2a931b5-275e-4fbc-bd3c-4ad40bfcca18",
      "name": "Continue Thread"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "ANh6UyX73j6pePQi",
          "mode": "list",
          "cachedResultUrl": "/workflow/ANh6UyX73j6pePQi",
          "cachedResultName": "Multi_Capture"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -12176,
        8512
      ],
      "id": "multi-extract-node",
      "name": "Multi Capture"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "0ceb9e91-e374-4346-8706-97df7d95cfe6",
              "leftValue": "={{ $json.ctx.event.tag }}",
              "rightValue": "--",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -12400,
        7936
      ],
      "id": "aebd154b-14e4-4927-b668-9adf8d7107f4",
      "name": "Tag is --"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "intent-activity",
                    "leftValue": "={{ $json.ctx.event.tag }}",
                    "rightValue": "!!",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "!!"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "intent-note",
                    "leftValue": "={{ $json.ctx.event.tag }}",
                    "rightValue": "..",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": ".."
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "intent-todo",
                    "leftValue": "={{ $json.ctx.event.tag }}",
                    "rightValue": "$$",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "$$"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "intent-chat",
                    "leftValue": "={{ $json.ctx.event.tag }}",
                    "rightValue": "++",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "++"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "intent-command",
                    "leftValue": "={{ $json.ctx.event.tag }}",
                    "rightValue": "::",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "::"
            }
          ]
        },
        "options": {}
      },
      "id": "52b76dff-86bf-4376-896a-ffd61ade887b",
      "name": "Route by Tag",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -12176,
        8224
      ]
    }
  ],
  "connections": {
    "Receive Event": {
      "main": [
        [
          {
            "node": "React with ðŸ”µ",
            "type": "main",
            "index": 0
          },
          {
            "node": "In Thread?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Tag?": {
      "main": [
        [
          {
            "node": "Route by Tag",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Multi Capture",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "In Thread?": {
      "main": [
        [
          {
            "node": "Tag is --",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Has Tag?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Projection": {
      "main": [
        [
          {
            "node": "Capture Projection",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tag is --": {
      "main": [
        [
          {
            "node": "Capture Thread",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Continue Thread",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Tag": {
      "main": [
        [
          {
            "node": "Prepare Projection",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Projection",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Projection",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Start Thread",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execute Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "JOXLqn9TTznBdo7Q"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "active": false
}
